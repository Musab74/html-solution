<? include "../include/header.html";?>

<? include "../include/guest_session.php"; ?>
<? include "../include/login_check.php"; ?>
<?
$ID = $_SESSION['LoginMemberID'];

//컨텐츠좋아요 list
$Like_list = array();
$SqlLike = "SELECT * from CourseLike WHERE ID = '$LoginMemberID'";
$QueqryLike = mysqli_query($connect, $SqlLike);
if($QueqryLike && mysqli_num_rows($QueqryLike)){
	while($RowLike = mysqli_fetch_array($QueqryLike)){
		$LikeCode = $RowLike['LectureCode'];
    	$Like_list[$LikeCode] = $LikeCode;
	}
}

//get study column lecturecode, seq 
$SqlM    = "SELECT LectureCode AS StudyLectureCode, Seq AS Study_Seq FROM Study WHERE ID = '$ID'";
$ResultM = mysqli_query($connect, $SqlM);
$RowM = mysqli_fetch_assoc($ResultM);


?>
<script>
//카테고리 검색
function CategorySearch(idx) {
    var data = $("#catChk"+idx).attr('value');
    $("#CategoryData").val(data);
    CategorySearchForm.submit();
}

//정렬 검색
function OrderSearch(idx) {
    var data = $("#orderChk"+idx).attr('value');
    $("#OrderData").val(data);
    OrderSearchForm.submit();
}
</script>
<body>
    <? include "../include/top_header.html";?>
    <div class="top_banner"><p>HRDe의 핵심적인 공통역량, 직무역량, 리더십 분야의 엄선된 노하우가 집약된<br>콘텐츠 저장소 <span class="hrdeflex">HRDe 아카이브를 </span>지금 수강하세요!</p></div>
    <div id="wrap">
        <div class="content_header mt10 pb20">
        <form name="BoardSearchForm" action="<?=$_SERVER['PHP_SELF']?>" method="GET">
            <div class="search_box">
                <input type="text" name="sw" id="sw" <?if($sw){?>value="<?=$sw?>"<?}?> placeholder="콘텐츠 검색">
                <i class="ph-bold ph-magnifying-glass"  onclick="Javascript:BoardSearch();"></i>
            </div>
		</form>
        </div>   
 
		<div class="lecture">
	        <h5><span class="fc_purple_gradient">HRDe ++</span>컨텐츠</h5>
	        <div class="circle_btn">
	            <div class="circleprev circleprev1"><i class="ph-bold ph-caret-left"></i></div>
	            <div class="circlenext circlenext1"><i class="ph-bold ph-caret-right"></i></div>
	        </div>
	        <div class="swiper mySwiper1">
	            <div class="swiper-wrapper">
	            	<?
					$i = 0;
					$SQL = "SELECT a.*, b.ServiceType, b.ContentsName, b.ctype, b.Del, b.UseYN , b.Keyword3 , b.PreviewImage, b.ContentsTime , b.Chapter , b.idx , b.cnt, b.ContentsStart, b.UploadDate
	                        FROM ContentsList AS a 
							LEFT OUTER JOIN Course AS b ON a.LectureCode=b.LectureCode 
							WHERE b.Del='N' AND a.gubun='4' AND b.UseYN = 'Y'
							ORDER BY a.OrderByNum ASC, a.idx ASC";
					//echo $SQL;
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							$LectureCode  = $ROW['LectureCode'];
							$Keyword3     = $ROW['Keyword3'];
							$PreviewImage = $ROW['PreviewImage'];
							$ContentsName = $ROW['ContentsName'];
							$ContentsTime = $ROW['ContentsTime'];
							$ContentsStart= $ROW['ContentsStart'];
							$UploadDate   = $ROW['UploadDate'];
							$Chapter      = $ROW['Chapter'];
							$idx	      = $ROW['idx'];
							$CourseCnt	  = $ROW['cnt'];
	
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 2);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$ContentsStart = substr($ContentsStart,0,10);
							$UploadDate = substr($UploadDate,0,10);
	
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
	                <div class="swiper-slide">
	                    <?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
	                        <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
	                        <li class="title">
							 	<span class="tag">
                                 <?
                                $keyword3Arr = explode(',', $Keyword3);
                                $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                                $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                                if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                                    while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                        extract($ROWKey3);
                                        if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                                    }
                                }
                                ?>
                                </span>
	                            <strong><?=$ContentsName?></strong>
	                            <span class="lecture_save" >
	                				<?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
								</span>
	                            <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                            <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                            <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    		<span class="lecture_time">업로드일 : <?=$UploadDate?></span>
	                        </li>
	                    </ul>
	                </div>
					<?
							$i++;
						}
					}
					?>
	            </div>
	        </div>
	    </div>
        <?
        $RecommendSQL     = " SELECT col3 FROM ArchiveAbilityResult1 WHERE ID = '$LoginMemberID' ";
        $RecommendQUERY   = mysqli_query($connect, $RecommendSQL);
        $RecommendKeyword = mysqli_fetch_assoc($RecommendQUERY);

        $SQL   = " SELECT * FROM Course a WHERE a.Del = 'N' AND a.UseYN = 'Y' AND Keyword3 IN (".$RecommendKeyword['col3'].") ORDER BY RAND() LIMIT 0, 20 ";
        $QUERY = mysqli_query($connect, $SQL);

        if ($QUERY && mysqli_num_rows($QUERY) > 0) {
        ?>
	    <div class="lecture">
	        <h5><span class="fc_purple_gradient">HRDe's PICK</span>추천 컨텐츠</h5>
	        <div class="circle_btn">
	            <div class="circleprev circleprev1"><i class="ph-bold ph-caret-left"></i></div>
	            <div class="circlenext circlenext1"><i class="ph-bold ph-caret-right"></i></div>
	        </div>
	        <div class="swiper mySwiper1">
	            <div class="swiper-wrapper">
	            	<?
					$i = 0;
					// $SQL = "SELECT a.*, b.ServiceType, b.ContentsName, b.ctype, b.Del, b.UseYN , b.Keyword3 , b.PreviewImage, b.ContentsTime , b.Chapter , b.idx , b.cnt, b.ContentsStart, b.UploadDate
	                //         FROM ContentsList AS a 
					// 		LEFT OUTER JOIN Course AS b ON a.LectureCode=b.LectureCode 
					// 		WHERE b.Del='N' AND a.gubun='1'
					// 		ORDER BY a.OrderByNum ASC, a.idx ASC";

                    $RecommendSQL     = " SELECT col3 FROM ArchiveAbilityResult1 WHERE ID = '$LoginMemberID' ";
                    $RecommendQUERY   = mysqli_query($connect, $RecommendSQL);
                    $RecommendKeyword = mysqli_fetch_assoc($RecommendQUERY);

                    $SQL         = " SELECT * FROM Course a WHERE a.Del = 'N' AND a.UseYN = 'Y' AND Keyword3 IN (".$RecommendKeyword['col3'].") ORDER BY RAND() LIMIT 0, 20 ";
					$QUERY       = mysqli_query($connect, $SQL);
                    $keyword3Arr = explode(',', $Keyword3);

					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							$LectureCode  = $ROW['LectureCode'];
							$Keyword3     = $ROW['Keyword3'];
							$PreviewImage = $ROW['PreviewImage'];
							$ContentsName = $ROW['ContentsName'];
							$ContentsTime = $ROW['ContentsTime'];
							$ContentsStart= $ROW['ContentsStart'];
							$UploadDate   = $ROW['UploadDate'];
							$Chapter      = $ROW['Chapter'];
							$idx	      = $ROW['idx'];
							$CourseCnt	  = $ROW['cnt'];
	
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 2);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$ContentsStart = substr($ContentsStart,0,10);
							$UploadDate = substr($UploadDate,0,10);
	
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
	                <div class="swiper-slide">
	                    <?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
                        <ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
	                        <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
	                        <li class="title">
                                <span class="tag">
                                <?
                                $keyword3Arr = explode(',', $Keyword3);
                                $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                                $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                                if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                                    while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                        extract($ROWKey3);
                                        if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                                    }
                                }
                                ?>
                                </span>
	                            <strong><?=$ContentsName?></strong>
	                            <span class="lecture_save" >
	                				<?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
								</span>
	                            <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                            <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                            <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    		<span class="lecture_time">업로드일 : <?=$UploadDate?></span>
	                        </li>
	                    </ul>
	                </div>
					<?
							$i++;
						}
					}
					?>
	            </div>
	        </div>
	    </div>
        <?
        }
        ?>
	    <div class="lecture">
	        <h5><span class="fc_purple">오늘의 TOP10</span>인기 컨텐츠</h5>
	        <div class="circle_btn">
	            <div class="circleprev circleprev2"><i class="ph-bold ph-caret-left"></i></div>
	            <div class="circlenext circlenext2"><i class="ph-bold ph-caret-right"></i></div>
	        </div>
	        <div class="swiper mySwiper2 hot">
	            <div class="swiper-wrapper">
	            	<?
					$i = 0;
					$SQL = "SELECT a.*, b.ServiceType, b.ContentsName, b.ctype, b.Del, b.UseYN , b.Keyword3 , b.PreviewImage, b.ContentsTime, b.Chapter , b.cnt , b.ContentsStart, b.UploadDate
	                        FROM ContentsList AS a 
							LEFT OUTER JOIN Course AS b ON a.LectureCode=b.LectureCode 
							WHERE b.Del='N' AND a.gubun='2' AND b.UseYN = 'Y'
							ORDER BY a.OrderByNum ASC, a.idx ASC";
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							$LectureCode = $ROW['LectureCode'];
							$Keyword3 = $ROW['Keyword3'];
							$PreviewImage = $ROW['PreviewImage'];
							$ContentsName = $ROW['ContentsName'];
							$ContentsTime = $ROW['ContentsTime'];
							$ContentsStart= $ROW['ContentsStart'];
							$UploadDate   = $ROW['UploadDate'];
							$Chapter      = $ROW['Chapter'];
							$idx	      = $ROW['idx'];
							$CourseCnt	  = $ROW['cnt'];
	
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 2);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$ContentsStart = substr($ContentsStart,0,10);
							$UploadDate = substr($UploadDate,0,10);
	
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
	                <div class="swiper-slide">
	                    <?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
                        <ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
	                        <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
	                        <li class="title">
							 	<span class="tag">
                                 <?
                                $keyword3Arr = explode(',', $Keyword3);
                                $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                                $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                                if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                                    while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                        extract($ROWKey3);
                                        if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                                    }
                                }
                                ?>
                                </span>
	                            <strong><?=$ContentsName?></strong>
	                            <span class="lecture_save" >
	                				<?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
								</span>
	                            <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                            <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                            <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    		<span class="lecture_time">업로드일 : <?=$UploadDate?></span>
	                        </li>
	                    </ul>
	                </div>
					<?
							$i++;
						}
					}
					?>
	            </div>
	        </div>
	    </div>
	    <div class="lecture">
	        <h5><span class="fc_purple">NEW</span>신규 컨텐츠</h5>
	        <div class="circle_btn">
	            <div class="circleprev circleprev3"><i class="ph-bold ph-caret-left"></i></div>
	            <div class="circlenext circlenext3"><i class="ph-bold ph-caret-right"></i></div>
	        </div>
	        <!--swiper-->
	        <div class="swiper mySwiper3">
	            <div class="swiper-wrapper">
	            	<?
					$i = 0;
					$SQL = "SELECT a.*, b.ServiceType, b.ContentsName, b.ctype, b.Del, b.UseYN , b.Keyword3 , b.PreviewImage, b.ContentsTime, b.Chapter , b.cnt, b.ContentsStart, b.UploadDate
	                        FROM ContentsList AS a 
							LEFT OUTER JOIN Course AS b ON a.LectureCode=b.LectureCode 
							WHERE b.Del='N' AND a.gubun='3' AND b.UseYN = 'Y'
							ORDER BY a.OrderByNum ASC, a.idx ASC";
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							$LectureCode = $ROW['LectureCode'];
							$Keyword3 = $ROW['Keyword3'];
							$PreviewImage = $ROW['PreviewImage'];
							$ContentsName = $ROW['ContentsName'];
							$ContentsTime = $ROW['ContentsTime'];
							$ContentsStart= $ROW['ContentsStart'];
							$UploadDate   = $ROW['UploadDate'];
							$Chapter      = $ROW['Chapter'];
							$idx	      = $ROW['idx'];
							$CourseCnt	  = $ROW['cnt'];
	
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 2);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$ContentsStart = substr($ContentsStart,0,10);
							$UploadDate = substr($UploadDate,0,10);
	
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
	                <div class="swiper-slide">
	                    <?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
                        <ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
	                        <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
	                        <li class="title">
							 	<span class="tag">
                                 <?
                                $keyword3Arr = explode(',', $Keyword3);
                                $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                                $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                                if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                                    while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                        extract($ROWKey3);
                                        if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                                    }
                                }
                                ?>
                                </span>
	                            <strong><?=$ContentsName?></strong>
	                            <span class="lecture_save" >
	                				<?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
								</span>
	                            <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                            <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                            <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    		<span class="lecture_time">업로드일 : <?=$UploadDate?></span>
	                        </li>
	                    </ul>
	                </div>
					<?
							$i++;
						}
					}
					?>
	            </div>
	        </div>
    	</div>    
    	<div class="lecture">
	        <h5><span>전체 컨텐츠</span></h5>
	        <div class="content_header">
	        	<form name="CategorySearchForm" action="<?=$_SERVER['PHP_SELF']?>" method="GET">
	            	<input type="hidden" name="CategoryData" id="CategoryData" value="<?=$CategoryData?>">
			        <ul class="category1">
			        	<li><a name="catChk" id="catChk0" href="Javascript:CategorySearch('0');" <?if($CategoryData == ""){?>class="on"<?}?> value="">전체</a></li>
			        	<?
			        	$k = 1;
	            		$SqlS = "SELECT * FROM CourseCategory WHERE Deep = 1 ORDER BY OrderByNum";
						//echo $SqlS;
						$QueryS = mysqli_query($connect, $SqlS);
						if($QueryS && mysqli_num_rows($QueryS)){
	            			while($RowS = mysqli_fetch_array($QueryS)){
	                			$idx = $RowS['idx'];
	                			$CategoryName = $RowS['CategoryName'];
						?>
						<li><a name="catChk" id="catChk<?=$idx?>" href="Javascript:CategorySearch(<?=$idx?>);" <?if($CategoryData == $idx){?>class="on"<?}?> value="<?=$idx?>"><?=$CategoryName?></a>
		            	<?
			            		$k++;
							}
						}
						?>
			        </ul>
			    </form>
				<form name="OrderSearchForm" action="<?=$_SERVER['PHP_SELF']?>" method="GET">
					<input type="hidden" name="OrderData" id="OrderData" value="<?=$OrderData?>">
					<ul class="category2">
						<li><a name="orderChk" id="orderChk1" href="Javascript:OrderSearch('1');" <?if($OrderData == 1){?>class="on"<?}?> value="1">최신순</a></li>
						<li><a name="orderChk" id="orderChk2" href="Javascript:OrderSearch('2');" <?if($OrderData == 2){?>class="on"<?}?> value="2">조회순</a></li>
						<li><a name="orderChk" id="orderChk3" href="Javascript:OrderSearch('3');" <?if($OrderData == 3){?>class="on"<?}?> value="3">평점순</a></li>
                        <li><a name="orderChk" id="orderChk4" href="Javascript:OrderSearch('4');" <?if($OrderData == 4){?>class="on"<?}?> value="4">찜한 컨텐츠순</a></li>
					</ul>
				</form>
	        	<form name="BoardSearchForm" action="<?=$_SERVER['PHP_SELF']?>" method="GET">
	                <div class="search_box">
			            <input type="text" name="sw" id="sw" <?if($sw){?>value="<?=$sw?>"<?}?> placeholder="콘텐츠 검색">
			            <i class="ph-bold ph-magnifying-glass"  onclick="Javascript:BoardSearch();"></i>
			        </div>
				</form>
		    </div>
        	<div class="lecture_wrap">
        	<?
        	if($_SESSION['LoginMemberID']) $where4SqlA = "WHERE ID = '$ID'";
        	else $where4SqlA = "";
        	
        	$SqlA = "SELECT Keyword1, Keyword2,
        					REPLACE(Keyword3, '|', ',') AS Keyword3, REPLACE(Keyword4, '|', ',') AS Keyword4
					 FROM MemberContents $where4SqlA";
			$ResultA = mysqli_query($connect, $SqlA);
			//echo $SqlA;
			$RowA = mysqli_fetch_array($ResultA);
			$Keyword1  = $RowA['Keyword1'];
			$Keyword2  = $RowA['Keyword2'];
			$Keyword3  = $RowA['Keyword3'];
			$Keyword4  = $RowA['Keyword4'];
			
			//관심분야
        	$SqlB = "SELECT GROUP_CONCAT(Keyword SEPARATOR '|') AS Keyword FROM ContentsKeyword WHERE Category=3 AND idx in ($Keyword3)";
			$ResultB = mysqli_query($connect, $SqlB);
			$RowB = mysqli_fetch_array($ResultB);
			$KeywordB = $RowB[0];
			//echo $KeywordB;
			
			//역량
			$SqlE = "SELECT Keyword FROM ContentsKeyword WHERE Category=4 AND idx in ($Keyword4)";
			$ResultE = mysqli_query($connect, $SqlE);
			$RowE = mysqli_fetch_array($ResultE);
			$KeywordE = $RowE[0];
			//echo $KeywordE;

			if($sw){
        		$where = " AND a.ContentsName LIKE '%$sw%' OR Keyword3 like '%$sw%'";
				$where2 = "";
			}else{
				$where = "";
				$where2 = " OR a.Keyword1 = '$Keyword1' AND a.Keyword2 = '$Keyword2' AND a.Keyword3 REGEXP('$KeywordB') AND a.Keyword4 REGEXP('$KeywordE') ";
			}

			if($CategoryData){
				$whereC = " AND a.Category1=$CategoryData";
				$where2 = "";
			}

			$JoinQuery = "";

			if($OrderData){
				if($OrderData == 1)			$OrderbyQuery = " ORDER BY a.RegDate DESC ";
				else if($OrderData == 2)	$OrderbyQuery = " ORDER BY a.cnt DESC ";
				else if($OrderData == 3)	$OrderbyQuery = " ORDER BY (SELECT AVG(StarPoint)  FROM Review WHERE LectureCode = a.LectureCode) DESC ";
				else if($OrderData == 4) {
					$JoinQuery = "LEFT JOIN CourseLike as cl ON cl.LectureCode = a.LectureCode";
					$where2 = "AND cl.ID='$LoginMemberID'";
					$OrderbyQuery = " ORDER BY cl.idx DESC ";
				}	
				else						$OrderbyQuery = " ORDER BY RAND() ";				
			}else{
				$OrderbyQuery = " ORDER BY RAND() ";
			}

        	$Sql = "SELECT COUNT(*)
        			FROM Course a
        			WHERE a.Del='N' AND a.UseYN='Y' AND a.PackageYN ='N' $where $whereC";
			//echo $Sql."<br>";
			$Result = mysqli_query($connect, $Sql);
			$Row = mysqli_fetch_array($Result);
			$TOT_NO = $Row[0];
			//echo $TOT_NO;

			$k = 1;
            $SqlC = "SELECT a.*
            		FROM Course a $JoinQuery
             		WHERE a.Del='N' AND a.UseYN = 'Y' AND a.UseYN='Y' AND a.PackageYN ='N' $where  $where2 $whereC
         			$OrderbyQuery LIMIT 12";
			//echo "C"."<br>".$SqlC;
			$QueryC = mysqli_query($connect, $SqlC);
			$TotalRowC = mysqli_num_rows($QueryC);
			$idxData;
            if($QueryC && mysqli_num_rows($QueryC)){
            	while($RowC = mysqli_fetch_array($QueryC)){
                	$idx = $RowC['idx'];
                	$PreviewImage = $RowC['PreviewImage'];
					$LectureCode  = $RowC['LectureCode'];
					$Keyword3     = $RowC['Keyword3'];
					$ContentsName = $RowC['ContentsName'];
					$ContentsTime = $RowC['ContentsTime'];
					$ContentsStart= $RowC['ContentsStart'];
					$UploadDate   = $RowC['UploadDate'];
					$Chapter      = $RowC['Chapter'];
					$CourseCnt    = $RowC['cnt'];

					$PreviewImageView = "/upload/Course/".$PreviewImage;

					$Keyword3 = str_replace(' ', '', $Keyword3);
					$Keyword3_array = explode('#',$Keyword3);
					$Keyword3_arrayA = array_slice($Keyword3_array, 1, 2);
					
					$ContentsStart = substr($ContentsStart,0,10);
					$UploadDate = substr($UploadDate,0,10);

					if($idxData == ""){
						$idxData = $idx;
					}else{
						$idxData = $idxData.",".$idx;
					}

					$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
					$ResultCNT = mysqli_query($connect, $SqlCNT);
					$RowCNT = mysqli_fetch_array($ResultCNT);
					$CNT = $RowCNT[0];
			?>
			<?if($Chapter == "0"){?>
				<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
			<?}else{?>
                <ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
			<?}?>
                	<li class="img" style="background-image: url(<?=$PreviewImageView?>);"></li>
                	<li class="title">
						<span class="tag">
                        <?
                        $keyword3Arr = explode(',', $Keyword3);
                        $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                        $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                        if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                            while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                extract($ROWKey3);
                                if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                            }
                        }
                        ?>
                        </span>
                    	<strong><?=$ContentsName?></strong>
	                    <span class="lecture_save" >
	                    	<?if($Like_list[$LectureCode] == $LectureCode){?>
							<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
							<?}else{?>
							<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
							<?}?>
						</span>
	                    <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                    <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                    <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    <span class="lecture_time">업로드일 : <?=$UploadDate?></span>
                	</li>
            	</ul>
            <?
            	$k++;
				}
			}
			if(!$sw && !$CategoryData && !$OrderData && $TotalRowC > 12){
				$LimitRows = 12-$TotalRowC;

				if($sw){
					$where3 = " AND a.ContentsName LIKE '%$sw%' OR Keyword3 like '%$sw%'";
					$where4 = "";
				}else{
					$where3 = "";
					$where4 = " OR a.Keyword1 = '$Keyword1' AND a.Keyword2 = '$Keyword2' AND a.Keyword3 REGEXP('$KeywordB') AND a.Keyword4 REGEXP('$KeywordE') ";
				}

				if($CategoryData){
					$whereC = " AND a.Category1=$CategoryData";
					$where4 = "";
				}
				
				if($OrderData){
					if($OrderData == 1)			$OrderbyQuery = " ORDER BY a.RegDate DESC ";
					else if($OrderData == 2)	$OrderbyQuery = " ORDER BY a.cnt DESC ";
					else if($OrderData == 3)	$OrderbyQuery = " ORDER BY (SELECT AVG(StarPoint)  FROM Review WHERE LectureCode = a.LectureCode) DESC ";
					else						$OrderbyQuery = " ORDER BY RAND() ";				
				}else{
					$OrderbyQuery = " ORDER BY RAND() ";
				}
				
				$SqlD = "SELECT a.*
						FROM Course a
						WHERE a.Del='N'  AND a.UseYN = 'Y' AND a.UseYN='Y' AND a.PackageYN ='N' $where3 $where4 $whereC
						$OrderbyQuery LIMIT $LimitRows";
				//echo "D"."<br>".$SqlD;
				$QueryD = mysqli_query($connect, $SqlD);
				$TotalRowD = mysqli_num_rows($QueryD);
				if($QueryD && mysqli_num_rows($QueryD)){
            		while($RowD = mysqli_fetch_array($QueryD)){
                		$idx = $RowD['idx'];
                		$PreviewImage = $RowD['PreviewImage'];
						$LectureCode = $RowD['LectureCode'];
						$Keyword3 = $RowD['Keyword3'];
						$ContentsName = $RowD['ContentsName'];
						$ContentsTime = $RowD['ContentsTime'];
			            $ContentsStart= $RowD['ContentsStart'];
            			$UploadDate   = $RowD['UploadDate'];
						$Chapter      = $RowD['Chapter'];
						$CourseCnt    = $RowD['cnt'];

						$PreviewImageView = "/upload/Course/".$PreviewImage;

						$Keyword3 = str_replace(' ', '', $Keyword3);
						$Keyword3_array = explode('#',$Keyword3);
						$Keyword3_arrayA = array_slice($Keyword3_array, 1, 2);
						
						$ContentsStart = substr($ContentsStart,0,10);
						$UploadDate = substr($UploadDate,0,10);

						if($idxData == ""){
							$idxData = $idx;
						}else{
							$idxData = $idxData.",".$idx;
						}

						$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
						$ResultCNT = mysqli_query($connect, $SqlCNT);
						$RowCNT = mysqli_fetch_array($ResultCNT);
						$CNT = $RowCNT[0];
			?>
			<?if($Chapter == "0"){?>
				<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
			<?}else{?>
                <ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
			<?}?>
	                <li class="img" style="background-image: url(<?=$PreviewImageView?>);"></li>
	                <li class="title">
						<span class="tag">
                        <?
                        $keyword3Arr = explode(',', $Keyword3);
                        $SQLKey3     = " SELECT aValue, idx AS keywordIdx FROM ArchiveQuestion WHERE aType = 'B' AND aDepth = 'step01' AND aGroup = 'A' AND aBind = 'col3' ORDER BY aOrder ASC ";
                        $QUERYKey3   = mysqli_query($connect, $SQLKey3);
                        if( $QUERYKey3 && mysqli_num_rows($QUERYKey3) ) {
                            while( $ROWKey3 = mysqli_fetch_array($QUERYKey3) ) {
                                extract($ROWKey3);
                                if ( in_array($keywordIdx, $keyword3Arr) ) echo "<b>#</b>".$aValue." ";
                            }
                        }
                        ?>
                        </span>
                    	<strong><?=$ContentsName?></strong>
	                    <span class="lecture_save" >
	                    	<?if($Like_list[$LectureCode] == $LectureCode){?>
							<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
							<?}else{?>
							<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
							<?}?>
						</span>
	                    <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
	                    <span class="lecture_time">조회수 : <?=$CourseCnt?></span>
	                    <span class="lecture_time">제작연도 : <?=$ContentsStart?></span>
	                    <span class="lecture_time">업로드일 : <?=$UploadDate?></span>
                	</li>
            	</ul>
			<?
					}
				}
			}else{
				$TotalRowD = 0;
			}

			$TotalRows = $TotalRowC + $TotalRowD;
            ?>
        </div>
        <div id="load">
			<button>+ 과정 더보기 </button>
    	</div>
    </div>
</div>
<!--more load-->
<script>
$(function(){
	var clickNum = 1; //버튼을 클릭한 수
	
	$("#load").click(function(e){		
		var totNo = <?=$TOT_NO?>; //컨텐츠 총개수
	   	var showNo = $(".lecture_wrap ul").length; //현재 보여지는 컨텐츠 개수
	   	var hiddenNo = totNo - showNo; //아직 보여지지 않은 컨텐츠 개수
	   	var idxData = "<?=$idxData?>"; //이미조회가된컨텐츠의 idx
	   	var pageStart = clickNum * 12;
	   	
	   	if(clickNum > 1){
	   		var num = clickNum-1;
	   		var textData = "idxData"+num;
	   		idxData = $('input[id='+textData+']').val();
	   	}
	   	
		CourseAdd(totNo, showNo, hiddenNo, pageStart, idxData, clickNum); //과정더보기		
		clickNum ++;
		
		//컨텐츠가 없으면 버튼도 숨김처리
		if(hiddenNo < 1){
			$(".lecture_wrap span").show();
			$('#load').fadeOut(100);
	   	}
    });
})

function CourseAdd(totNo, showNo, hiddenNo, pageStart, idxData, clickNum) {
	var sw = $("#sw").val();
	var CategoryData = $("#CategoryData").val();
	var OrderData = $("#OrderData").val();
	var Keyword1  = "<?=$Keyword1?>";
	var Keyword2  = "<?=$Keyword2?>";
	var KeywordB  = "<?=$KeywordB?>";
	var KeywordE  = "<?=$KeywordE?>";
	
	$.post('/archive/contents/course_list.php',
		{
		  sw: sw,
		  CategoryData: CategoryData,
		  OrderData: OrderData,
		  pageStart: pageStart,
		  Keyword1: Keyword1,
		  Keyword2: Keyword2,
		  KeywordB: KeywordB,
		  KeywordE: KeywordE,
		  idxData: idxData,
		  clickNum: clickNum},
		function(data, stauts){
			//컨텐츠가 없을 때는 append 하지 않음
			if(hiddenNo > 0){
				$(".lecture_wrap").append(data);
			}			
		}
	);
}
</script>
</body>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
	var swiper = new Swiper(".mySwiper1", {
        speed: 1000,
            autoplay: {
            delay: 2500,
            disableOnInteraction: false,
        },
        loop: true,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".circlenext1",
            prevEl: ".circleprev1",
        },
        slidesPerView: 4,
        spaceBetween: 30,
        breakpoints: {
            1400: {
                slidesPerView: 4,
                spaceBetween: 30
            },
            1070: {
                slidesPerView: 3,
                spaceBetween: 20
            },
            720: {
                slidesPerView: 2,
                spaceBetween: 10
            },
            320: {
                slidesPerView: 1,
                spaceBetween: 10
            }
            ,
            120: {
                slidesPerView: 1,
                spaceBetween: 10
            }
        }
    });
    var swiper = new Swiper(".mySwiper2", {
        speed: 1000,
        autoplay: {
        	delay: 2500,
        	disableOnInteraction: false,
        },
        loop: true,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".circlenext2",
            prevEl: ".circleprev2",
        },
        slidesPerView: 4,
        spaceBetween: 30,
        breakpoints: {
            1400: {
                slidesPerView: 4,
                spaceBetween: 30
            },
            1070: {
                slidesPerView: 3,
                spaceBetween: 20
            },
            720: {
                slidesPerView: 2,
                spaceBetween: 10
            },
            320: {
                slidesPerView: 1,
                spaceBetween: 10
            }
            ,
            120: {
                slidesPerView: 1,
                spaceBetween: 10
            }
        }
    });
    var swiper = new Swiper(".mySwiper3", {
        speed: 1000,
            autoplay: {
            delay: 2500,
            disableOnInteraction: false,
        },
        loop: true,
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        navigation: {
            nextEl: ".circlenext3",
            prevEl: ".circleprev3",
        },
        slidesPerView: 4,
        spaceBetween: 30,
        breakpoints: {
            1400: {
                slidesPerView: 4,
                spaceBetween: 30
            },
            1070: {
                slidesPerView: 3,
                spaceBetween: 20
            },
            720: {
                slidesPerView: 2,
                spaceBetween: 10
            },
            320: {
                slidesPerView: 1,
                spaceBetween: 10
            }
            ,
            120: {
                slidesPerView: 1,
                spaceBetween: 10
            }
        }
    });
</script>
<!--2row swiper-->
<!--<? include $_SERVER['DOCUMENT_ROOT'] . "/popup/include_popup.php"; ?>-->
<?php include "../include/footer.html"; ?>