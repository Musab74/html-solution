<? include "../include/header.html";?>
<body>
<? include "../include/top_header.html";?>
<? include "../include/contents_header.html";?>
<? include "../include/login_check.php"; ?>

<?
$PCategory = Replace_Check($PCategory); //상위카테고리
$Category  = Replace_Check($Category);	//하위카테고리

if($PCategory == 1) $PageName = "공통역량";
else if($PCategory == 5) $PageName = "직무역량";
else if($PCategory == 9) $PageName = "리더십";
else if($PCategory == 13) $PageName = "HRDe++";
else  $PageName = "공통역량";

$ID = $_SESSION['LoginMemberID'];

//get study column lecturecode, seq 
$SqlM    = "SELECT LectureCode AS StudyLectureCode, Seq AS Study_Seq FROM Study WHERE ID = '$ID'";
$ResultM = mysqli_query($connect, $SqlM);
$RowM = mysqli_fetch_assoc($ResultM);
$contentsCate = ($CategoryData == 0) ? "" : " AND Keyword2 = $CategoryData ";
//컨텐츠좋아요 list
$Like_list = array();
$SqlLike = "SELECT * from CourseLike WHERE ID = '$LoginMemberID'";
$QueqryLike = mysqli_query($connect, $SqlLike);
if($QueqryLike && mysqli_num_rows($QueqryLike)){
	while($RowLike = mysqli_fetch_array($QueqryLike)){
		$LikeCode = $RowLike['LectureCode'];
    	$Like_list[$LikeCode] = $LikeCode;
	}
}
?>
    <div id="wrap">
        <div class="lecture_top">
            <strong><?=$PageName?></strong> 
            <div class="select-box">
                <select onchange="location.href=this.value">
                    <option value="/m_archive/contents/contents_list.html?PCategory=1" <? if($PCategory == 1) {?> selected <? } ?> >공통역량</option>
                    <option value="/m_archive/contents/contents_list.html?PCategory=5" <? if($PCategory == 5) {?> selected <? } ?>>직무역량</option>
                    <option value="/m_archive/contents/contents_list.html?PCategory=9" <? if($PCategory == 9) {?> selected <? } ?>>리더십</option>
                    <option value="/m_archive/contents/contents_list.html?PCategory=13" <? if($PCategory == 13) {?> selected <? } ?>>HRDe++</option>
                </select>
            </div>
            <div class="select-box">
                <select onchange="location.href=this.value">
                    <option value="/m_archive/contents/contents_list.html?PCategory=<?=$PCategory?>">전체</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=X" <? if($ctype == "X") {?> selected <? } ?>>이러닝</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=Z" <? if($ctype == "Z") {?> selected <? } ?>>마이크로러닝</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=Y" <? if($ctype == "Y") {?> selected <? } ?>>숏폼</option>
                </select>
            </div>
        </div>
        
        <!--이러닝-->
        <div class="lecture">
            <h5><b>이러닝</b></h5>
            <div class="circle_btn">
                <div class="circleprev circleprev1"><i class="ph-bold ph-caret-left"></i></div>
                <div class="circlenext circlenext1"><i class="ph-bold ph-caret-right"></i></div>
            </div>         
            <div class="swiper mySwiper1">
                <div class="swiper-wrapper">
					<?
					if($Category) $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'X' AND Category1 = $PCategory AND Category2 = $Category ".$contentsCate;
					else  $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'X' AND Category1 = $PCategory ".$contentsCate;
					
					$i = 0;
                    $SQL = "SELECT * FROM Course $where  LIMIT 39";
					// echo $SQL;
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							extract($ROW);
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 3);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
					<div class="swiper-slide" >
						<?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
                            <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
                            <li class="title">
								<? while (list($key,$value)=each($Keyword_arrayA)){ ?>
							 	<span class="tag">#<?=$value?></span>
								<? } ?>
                                <strong><?=$ContentsName?></strong>
                                <span class="lecture_save">
                                    <?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
                                </span>
                                <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
                            </li>
                        </ul>
                    </div>
					<?
							$i++;
						}
					}
					?>
                </div>
            </div>
        </div>
        <!--//이러닝-->
        
        <!--마이크로러닝-->
        <div class="lecture">
            <h5><b>마이크로러닝</b></h5>
            <div class="circle_btn">
                <div class="circleprev circleprev2"><i class="ph-bold ph-caret-left"></i></div>
                <div class="circlenext circlenext2"><i class="ph-bold ph-caret-right"></i></div>
            </div>         
            <div class="swiper mySwiper2">
                <div class="swiper-wrapper">
					<?
					if($Category) $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'Y' AND Category1 = $PCategory AND Category2 = $Category ".$contentsCate;
					else  $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'Z' AND Category1 = $PCategory ".$contentsCate;
					
					$i = 0;
					$SQL = "SELECT * FROM Course $where  LIMIT 39";
					//echo $SQL;
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							extract($ROW);
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 3);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
                    <div class="swiper-slide" >
						<?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
                            <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
                            <li class="title">
                                <? while (list($key,$value)=each($Keyword_arrayA)){ ?>
							 	<span class="tag">#<?=$value?></span>
								<? } ?>
                                <strong><?=$ContentsName?></strong>
                                <span class="lecture_save">
                                    <?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
                                </span>
                                <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
                            </li>
                        </ul>
                    </div>                    
					<?
							$i++;
						}
					}
					?>           
                </div>            
            </div>
        </div>
        <!--//마이크로러닝-->
        
        <!--숏폼-->
        <div class="lecture" style="margin-bottom: 100px;">
            <h5><b>숏폼</b></h5>
            <div class="circle_btn">
                <div class="circleprev circleprev3"><i class="ph-bold ph-caret-left"></i></div>
                <div class="circlenext circlenext3"><i class="ph-bold ph-caret-right"></i></div>
            </div>         
            <div class="swiper mySwiper3">
                <div class="swiper-wrapper">
					<?
                    if($Category) $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'Z' AND Category1 = $PCategory AND Category2 = $Category ".$contentsCate;
					else  $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = 'Y' AND Category1 = $PCategory ".$contentsCate;
					
					$i = 0;
                    $SQL = "SELECT * FROM Course $where ORDER BY idx  LIMIT 39";
					//echo $SQL;
					$QUERY = mysqli_query($connect, $SQL);
					if($QUERY && mysqli_num_rows($QUERY)){
						while($ROW = mysqli_fetch_array($QUERY)){
							extract($ROW);
							$Keyword = str_replace(' ', '', $Keyword3);
							$Keyword_array = explode('#',$Keyword);
							$Keyword_arrayA = array_slice($Keyword_array, 1, 3);
							$ImgUrl = "/upload/Course/".$PreviewImage;
							
							$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
							$ResultCNT = mysqli_query($connect, $SqlCNT);
							$RowCNT = mysqli_fetch_array($ResultCNT);
							$CNT = $RowCNT[0];
					?>
                    <div class="swiper-slide" >
                        <?if($Chapter == "0"){?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
						<?}else{?>
						<ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1', '<?=$RowM['Study_Seq']?>', '<?=$RowM['StudyLectureCode']?>');">
						<?}?>
                            <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
                            <li class="title">
                                <? while (list($key,$value)=each($Keyword_arrayA)){ ?>
							 	<span class="tag">#<?=$value?></span>
								<? } ?>
                                <strong><?=$ContentsName?></strong>
                                <span class="lecture_save">
                                    <?if($Like_list[$LectureCode] == $LectureCode){?>
									<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}else{?>
									<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
									<?}?>
                                </span>
                                <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
                            </li>
                        </ul>
                    </div>
					<?
							$i++;
						}
					}
					?> 
                </div>
            </div>
        </div>
        <!--//숏폼-->        
    </div>
</body>
<?php include "../include/footer.html"; ?>


<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
<script>
    //이러닝
	var swiper = new Swiper(".mySwiper1", {
        pagination: {
            el: ".swiper-pagination1",
            clickable: true,
            renderBullet: function (index, className) {
                return '<span class="' + className + '">' + (index + 1) + '</span>';
            }
        },
        navigation: {
            nextEl: ".circlenext1",
            prevEl: ".circleprev1",
        },
        slidesPerView: 1,
        slidesPerGroup: 1, 
    });

    //마이크로러닝
    var swiper = new Swiper(".mySwiper2", {
        pagination: {
            el: ".swiper-pagination2",
            clickable: true,
            renderBullet: function (index, className) {
                return '<span class="' + className + '">' + (index + 1) + '</span>';
            }
        },
        navigation: {
            nextEl: ".circlenext2",
            prevEl: ".circleprev2",
        },
        slidesPerView: 1,
        slidesPerGroup: 1, 
       
    });

    //숏폼
    var swiper = new Swiper(".mySwiper3", {
        pagination: {
            el: ".swiper-pagination3",
            clickable: true,
            renderBullet: function (index, className) {
                return '<span class="' + className + '">' + (index + 1) + '</span>';
            }
        },
        navigation: {
            nextEl: ".circlenext3",
            prevEl: ".circleprev3",
        },
        slidesPerView: 1,
        slidesPerGroup: 1, 
      
    });
</script>

