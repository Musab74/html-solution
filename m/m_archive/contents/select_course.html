<? include "../include/header.html";?>
<body>
<? include "../include/top_header.html";?>
<? include "../include/contents_header.html";?>
<!-- 페이징에 영향을 주는 form 태그 -->
<form name="listScriptForm" method="GET" action="<?=$_SERVER['PHP_SELF']?>">
<input type="hidden" name="pg" value="<?=$pg?>">
<input type="hidden" name="PCategory" value="<?=$PCategory?>">
<input type="hidden" name="ctype" value="<?=$ctype?>">
<input type="hidden" name="CategoryData" value="<?=$CategoryData?>">
</form>
<?
$pg = Replace_Check_XSS2($pg);
$PCategory = Replace_Check($PCategory);
$ctype  = Replace_Check($ctype);

if($PCategory == 1) $PageName = "공통역량";
else if($PCategory == 5) $PageName = "직무역량";
else if($PCategory == 9) $PageName = "리더십";
else  $PageName = "공통역량";

if($ctype == "X") $PageName2 = "이러닝";
else if($ctype == "Z") $PageName2 = "마이크로닝";
else if($ctype == "Y") $PageName2 = "숏폼";
else  $PageName2 = "이러닝";

$ID = $_SESSION['LoginMemberID'];
$SqlM    = "SELECT LectureCode AS StudyLectureCode, Seq AS Study_Seq FROM Study WHERE ID = '$ID'";
$ResultM = mysqli_query($connect, $SqlM);
$RowM = mysqli_fetch_assoc($ResultM);
//컨텐츠좋아요 list
$Like_list = array();
$SqlLike = "SELECT * from CourseLike WHERE ID = '$LoginMemberID'";
$QueqryLike = mysqli_query($connect, $SqlLike);
if($QueqryLike && mysqli_num_rows($QueqryLike)){
	while($RowLike = mysqli_fetch_array($QueqryLike)){
		$LikeCode = $RowLike['LectureCode'];
    	$Like_list[$LikeCode] = $LikeCode;
	}
}
$contentsCate = ($CategoryData == 0) ? "" : " AND Keyword2 = $CategoryData ";
if($Category) $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = '$ctype' AND Category1 = $PCategory AND Category2 = $Category ".$contentsCate;
else  $where = " WHERE Del='N' AND UseYN = 'Y' AND ServiceType = '$ctype' AND Category1 = $PCategory ".$contentsCate;

//페이지 조건
if(!$pg) $pg = 1;
$page_size = 12;
$block_size = 10;

//검색 등록수
$Sql = "SELECT COUNT(*) FROM Course $where";
$Result = mysqli_query($connect, $Sql);
$Row = mysqli_fetch_array($Result);
$TOT_NO = $Row[0];

//페이지 클래스 생성
include_once("../../m_include/include_page.php");

$PAGE_CLASS = new Page($pg,$TOT_NO,$page_size,$block_size); ##-- 페이지 클래스
$BLOCK_LIST = $PAGE_CLASS->blockList(); ##-- 페이지 이동관련
$PAGE_UNCOUNT = $PAGE_CLASS->page_uncount; ##-- 게시물 번호 한개씩 감소
?>
    <div id="wrap">
        <div class="lecture_top">
            <strong><?=$PageName?></strong>
            <div class="select-box">
                <select onchange="location.href=this.value">
                    <option value="/m_archive/contents/contents_list.html?PCategory=1" <? if($PCategory == 1) {?> selected <? } ?> >공통역량</option>
                    <option value="/m_archive/contents/contents_list.html?PCategory=5" <? if($PCategory == 5) {?> selected <? } ?>>직무역량</option>
                    <option value="/m_archive/contents/contents_list.html?PCategory=9" <? if($PCategory == 9) {?> selected <? } ?>>리더십</option>
                </select>
            </div>
            <div class="select-box">
                <select onchange="location.href=this.value">
                    <option value="/m_archive/contents/contents_list.html?PCategory=<?=$PCategory?>">전체</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=X" <? if($ctype == "X") {?> selected <? } ?>>이러닝</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=Z" <? if($ctype == "Z") {?> selected <? } ?>>마이크로러닝</option>
                    <option value="/m_archive/contents/select_course.html?PCategory=<?=$PCategory?>&ctype=Y" <? if($ctype == "Y") {?> selected <? } ?>>숏폼</option>
                </select>
            </div>
        </div>
        
        <div class="lecture">
            <h5><b><?=$PageName2?></b></h5>
            <div class="grid-wrapper">
				<?
				$i = 0;
				$SQL = "SELECT * FROM Course $where ORDER BY idx LIMIT $PAGE_CLASS->page_start, $page_size";
				//echo $SQL;
				$QUERY = mysqli_query($connect, $SQL);
				if($QUERY && mysqli_num_rows($QUERY)){
					while($ROW = mysqli_fetch_array($QUERY)){
						extract($ROW);
						$Keyword = str_replace(' ', '', $Keyword3);
						$Keyword_array = explode('#',$Keyword);
						$Keyword_arrayA = array_slice($Keyword_array, 1, 3);
						$ImgUrl = "/upload/Course/".$PreviewImage;
						
						$SqlCNT = "SELECT COUNT(LectureCode) AS CNT  FROM CourseLike WHERE LectureCode ='$LectureCode'";
						$ResultCNT = mysqli_query($connect, $SqlCNT);
						$RowCNT = mysqli_fetch_array($ResultCNT);
						$CNT = $RowCNT[0];
				?>
                <div class="grid-slide">
                    <?if($Chapter == "0"){?>
					<ul class="edu_contents" onclick="Javascript:ContentsPlayer('<?=$LectureCode?>');">
					<?}else{?>
					<ul class="edu_contents" onclick="Javascript:ContentsPlayer2('<?=$LectureCode?>','1');">
					<?}?>
                        <li class="img" style="background-image: url(<?=$ImgUrl?>);"></li>
                        <li class="title">
                            <? while (list($key,$value)=each($Keyword_arrayA)){ ?>
						 	<span class="tag">#<?=$value?></span>
							<? } ?>
                            <strong><?=$ContentsName?></strong>
                            <span class="lecture_save">
                                <?if($Like_list[$LectureCode] == $LectureCode){?>
								<i class="ph-fill ph-heart" style="color:red;" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
								<?}else{?>
								<i class="ph-light ph-heart" onclick="CourseLike(this,'<?=$LectureCode?>', '<?=$LoginMemberID?>')" name="courseLike" id="like_<?=$idx?>"></i><?=$CNT?>
								<?}?>
                            </span>
                            <span class="lecture_time"><i class="ph-light ph-clock"></i><?=$ContentsTime?>분</span>
                        </li>
                    </ul>
                </div>
				<?
						$i++;
					}
				}
				?>
            </div>
            
 			<!-- page -->
 			<?=$BLOCK_LIST?>       
            <!-- //page -->
        </div>
    </div>
</body>
<?php include "../include/footer.html"; ?>

